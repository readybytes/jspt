<?xml version="1.0" ?>
<!-- $Id: build.xml shyam $ -->
<project name="JSPT Component" basedir="." default="build" description="Phing build script for JSPT package.">

	<target name="config" description="Load configuration file">
		<property file="build.properties"  override="false" />
	</target>

	
	<target name="build" description="build installable package only" depends="config,svn_lastrevision">
		<mkdir dir="${global.dir.packages}" />
		<mkdir dir="${global.dir.tmp}" />

		<phingcall target="export_from_wc" />
		<!-- Process all build process here -->
		<phing phingfile="com_xipt.xml" inheritAll="true" target="build" />
		<phing phingfile="plg_xipt_system.xml" inheritAll="true" target="build" />
		<phing phingfile="plg_xipt_community.xml" inheritAll="true" target="build" />

		<mkdir dir="JSPT-${global.version}.${svn.lastrevision}-Unzip-First" />
		<delete file="${dir.packages}/JSPT-${global.version}.${svn.lastrevision}-Unzip-First.zip" />

		<copy todir="JSPT-${global.version}.${svn.lastrevision}-Unzip-First">
			<fileset dir="${global.dir.packages}">
				<include name="*${global.version}.${svn.lastrevision}*.zip" />
			</fileset>
		</copy>

			<zip destfile="${global.dir.packages}/JSPT-${global.version}.${svn.lastrevision}-Unzip-First.zip" 
			basedir="JSPT-${global.version}.${svn.lastrevision}-Unzip-First" />

		<delete dir="JSPT-${global.version}.${svn.lastrevision}-Unzip-First" includeemptydirs="true"/>
		<delete dir="${global.dir.tmp}" includeemptydirs="true" />
	</target>


	<!-- Global Target -->
	<target name="export_from_wc" description="Export files from a local working copy" depends="config">
		<copy todir="${global.dir.tmp}">
			<fileset dir="${global.dir.local}">
				<include name="**" />
			</fileset>
		</copy>
		
		<!-- apply lint -->
<analyze analyzerPath="/usr/local/bin/zca" disable="var-ref-notmodified,if-if-else,expr-unused,include-var" >
	<fileset dir="${global.dir.tmp}">
	    <include name="**/*.php"/>
	</fileset>
</analyze>


		<!-- gather stats phpcpd / phploc / test-count,assert-count, xitodo/codrev numbers / coverage numbers  -->
	</target>

	<target name="svn_lastrevision" depends="config">
		<svnlastrevision workingcopy="${global.dir.local}" propertyname="svn.lastrevision" />
	</target>
	
</project>
